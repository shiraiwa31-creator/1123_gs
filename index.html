<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>janken-shinka</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
      <div id="game">
    <h1>é–“é•ã„æ¢ã—</h1>
    <div class="info">
      åŒã˜é¡”ãŒä¸¦ã¶ä¸­ã«ã€1ã¤ã ã‘é•ã†é¡”ãŒã‚ã‚‹ã‚ˆã€‚<br>
      30ç§’ä»¥å†…ã«ã§ãã‚‹ã ã‘ãŸãã•ã‚“å½“ã¦ã¦ã­ï¼
    </div>

    
    <div class="status">
      <div>ãƒ¬ãƒ™ãƒ«ï¼š<span id="level">1</span></div>
      <div>ã‚¯ãƒªã‚¢ï¼š<span id="clears">0</span> å›</div>
      <div>æ®‹ã‚Šï¼š<span id="time">30</span> ç§’</div>
    </div>

    <div class="board">
    <div class="grid" id="grid"></div>
    </div>
    <div id="message"></div>

    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

  <script>
    const gridEl   = document.getElementById("grid");
    const msgEl    = document.getElementById("message");
    const levelEl  = document.getElementById("level");
    const clearsEl = document.getElementById("clears");
    const timeEl   = document.getElementById("time");
    const startBtn = document.getElementById("startBtn");
    const gameEl   = document.getElementById("game");

    const normalFace = "ğŸ˜‰"; 
    const oddFace    = "ğŸ˜Š"; // æ­£è§£

    let oddIndex = -1;
    let level = 1;
    let clears = 0;
    let timeLeft = 30;
    let timerId = null;
    let gameActive = false;

    function getGridSizeFromLevel(lv) {
      if (lv === 1) return 3 * 3;   // 9ãƒã‚¹
      if (lv === 2) return 4 * 4;   // 16ãƒã‚¹
      return 5 * 5;                 // 25ãƒã‚¹ï¼ˆlv3ä»¥é™ï¼‰
    }

    function applyGridLayout(gridCount) {
      const side = Math.sqrt(gridCount);
      gridEl.style.gridTemplateColumns = `repeat(${side}, 1fr)`;
    }

    function setupGame() {
      const cellCount = getGridSizeFromLevel(level);
      applyGridLayout(cellCount);

      gridEl.innerHTML = "";
      msgEl.textContent = "";

      oddIndex = Math.floor(Math.random() * cellCount);

      for (let i = 0; i < cellCount; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.dataset.index = i;

        if (i === oddIndex) {
          cell.textContent = oddFace;
        } else {
          cell.textContent = normalFace;
        }

        cell.addEventListener("click", onCellClick);
        gridEl.appendChild(cell);
      }
    }

    function onCellClick(e) {
      if (!gameActive) return; // ã‚²ãƒ¼ãƒ ä¸­ä»¥å¤–ã¯åå¿œã—ãªã„

      const index = Number(e.currentTarget.dataset.index);

      if (index === oddIndex) {
        // æ­£è§£
        clears++;
        level++;
        clearsEl.textContent = clears;
        levelEl.textContent = level;
        setupGame(); // æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸
      } else {
        // ä¸æ­£è§£ â†’ ãƒ†ã‚­ã‚¹ãƒˆã¯å¤‰ãˆãšã€ç”»é¢ã‚’å·¦å³ã«æºã‚‰ã™
        shakeScreen();
      }
    }

    function shakeScreen() {
      gameEl.classList.remove("shake"); 
      void gameEl.offsetWidth; // ãƒªãƒ•ãƒ­ãƒ¼
      gameEl.classList.add("shake");
    }

    function startTimer() {
      timeLeft = 30;
      timeEl.textContent = timeLeft;

      if (timerId) clearInterval(timerId);

      timerId = setInterval(() => {
        timeLeft--;
        timeEl.textContent = timeLeft;

        if (timeLeft <= 0) {
          clearInterval(timerId);
          gameActive = false;
          msgEl.textContent = `ãŠã‚ã§ã¨ã†ï¼ ${clears}å›é”æˆ`;
          startBtn.disabled = false;
          startBtn.textContent = "ã‚‚ã†ä¸€åº¦";
        }
      }, 1000);
    }

    function startGame() {
      // ãƒªã‚»ãƒƒãƒˆ
      level = 1;
      clears = 0;
      levelEl.textContent = level;
      clearsEl.textContent = clears;
      msgEl.textContent = "";

      gameActive = true;
      startBtn.disabled = true;

      setupGame();
      startTimer();
    }

    startBtn.addEventListener("click", startGame);

    // åˆæœŸçŠ¶æ…‹ï¼ˆã¨ã‚Šã‚ãˆãšãƒ¬ãƒ™ãƒ«1ã®ç›¤é¢ã ã‘è¡¨ç¤ºï¼‰
    setupGame();
  </script>
</body>
</html>